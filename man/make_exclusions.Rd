% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/flowex.R
\name{make_exclusions}
\alias{make_exclusions}
\title{Perform Sequential Exclusions}
\usage{
make_exclusions(criteria, data)
}
\arguments{
\item{criteria}{Tibble with filtering criteria. Must contain three variables:
\itemize{
\item \code{left} String with description of data before applying the filter.
\item \code{right} String with description of data after applying the filter.
\item \code{filter} Filtering expression quoted using \code{\link[rlang]{expr}}.
The filter in the last row will not be executed, because the last row
serves as a description of the final data set. See examples.
}}

\item{data}{Tibble with data set on which the filtering criteria should be
applied.}
}
\value{
A tibble. Each row is a filtering step. Variables:
\itemize{
\item \code{left}: Labels for included subset that is "left" after the filter.
\item \code{right}: Labels for excluded subset (which
\code{\link[khsmisc]{exclusion_flowchart}} plots to the right).
\item \code{included} The data before applying the row's filter.
\item \code{excluded} The data after applying the row's filter.
\item \code{n_left} Number of observations before applying the row's filter.
\item \code{n_right} Number of observations after applying the row's filter.
The last row, \code{included}, contains the data after applying all filters.
Access this tibble using \code{\%>\% pull(included) \%>\% last()}.
}
}
\description{
This function performs sequential, user-defined \code{\link[dplyr]{filter}}
steps on the input data set. It generates the filtered data and a tibble that
can be directly passed on to \code{\link[khsmisc]{exclusion_flowchart}} to
plot a flowchart of exclusions.
}
\section{Example Output}{

\if{html}{\figure{make_exclusions.png}{options: width=70\%}}
}

\examples{
# Example data set
data(cancer, package = "survival")
cancer <- cancer \%>\% tibble::as_tibble()
cancer

# Define exclusion criteria
criteria <- tibble::tribble(
  ~left,                   ~right,                ~filter,
  "All patients",          "Missing ECOG status", expr(!is.na(ph.ecog)),
  "Known ECOG",            "Exclude men",         expr(sex == 2),
  "Analytical population", "",                    expr(TRUE))

# Perform sequential exclusions
result <- make_exclusions(criteria = criteria, data = cancer)

# Show results
result

# Access study population after all exclusions
result \%>\%
  dplyr::pull(included) \%>\%
  dplyr::last()

# Plot flow chart of exclusions (might not display in the online reference)
result \%>\%
  exclusion_flowchart()

}
